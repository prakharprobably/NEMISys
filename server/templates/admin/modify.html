{% extends "base.html" %}
{% block title %}Edit Staff{% endblock %}
{% block body %}
<form method="POST">
    <div>
        <h>Edit Staff</h><br/>

        <label for="uuid">UUID</label>
        <input id="uuid" name="uuid" placeholder="Enter UUID" maxlength="6"
               value="{{ oldData[0] if oldData else '' }}"
               oninput="autoSubmitIfReady(this)" /><br/>

        <label for="name">Name</label>
        <input id="name" name="name" placeholder="Enter Name"
               value="{{ oldData[1] if oldData else '' }}" /><br/>

        <label for="class">Class</label>
        <input id="class" name="class" placeholder="Enter Class"
               value="{{ oldData[2] if oldData else '' }}" /><br/>

        <label for="section">Section</label>
        <input id="section" name="section" placeholder="Enter Section"
               value="{{ oldData[3] if oldData else '' }}" /><br/>

        <label for="event">Event</label><br/>
        <select id="event" name="event">
            {% for event in events %}
            <option value="{{event}}">{{event}}</option>
            {% endfor %}
            <option value="all">All</option>
        </select><br/>

        <label for="permissions">Change Permissions</label>
        <div>
            {% set perms = oldData[5] if oldData else [] %}
            {% for code, label in [
                ('TC', 'Teacher Incharge'),
                ('EI', 'Overall Incharge'),
                ('SI', 'Event Incharge'),
                ('CW', 'Certificate Writer'),
                ('RC', 'Result Compilation'),
                ('RG', 'Registrar'),
                ('VL', 'Volunteer')] %}
                <input type="checkbox" id="{{ label | replace(' ', '') }}"
                       name="permissions" value="{{ code }}"
                       {% if code in perms %}checked{% endif %}>
                <label for="{{ label | replace(' ', '') }}">{{ label }}</label><br/>
            {% endfor %}
        </div>
        <br/>
        <button type="submit">Edit</button>
    </div>
</form>

<script>
    function autoSubmitIfReady(input) {
        if (input.value.length === 6) {
            const uuid = input.value;
            const form = input.form;
    
            // Construct a query string and redirect the browser (GET request)
            const url = new URL(window.location.href);
            url.searchParams.set("uuid", uuid);
            window.location.href = url.toString();
        }
    }
    </script>
{% endblock %}
